<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è“è‰²è¿œæ–¹ - çƒ¨å­çš„æ—¶å…‰èƒ¶å›Š</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #e9f2f9;
            --bg-secondary: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --accent: #4c9ce6;
            --accent-light: #7ab3e8;
            --highlight: #ff6b6b;
            --card-shadow: 0 2px 10px rgba(76, 156, 230, 0.15);
            --border-color: #d9e7f5;
            --space-blue: #e1ecf7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', 'Microsoft YaHei', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            background-image: linear-gradient(to bottom, #f0f8ff, #e9f2f9);
        }

        /* å¼€å§‹é¡µé¢ */
        .intro-page {
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(135deg, #6a8cb3 0%, #4c9ce6 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .intro-container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .story-text {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: justify;
            color: #333;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .story-text::-webkit-scrollbar {
            width: 6px;
        }

        .story-text::-webkit-scrollbar-thumb {
            background: #4c9ce6;
            border-radius: 3px;
        }

        .story-text p {
            margin-bottom: 15px;
            text-indent: 2em;
        }

        .start-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 40px;
            background: linear-gradient(to right, #4c9ce6, #3a87d4);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 156, 230, 0.3);
        }

        .start-btn:hover {
            background: linear-gradient(to right, #3a87d4, #2a6bb9);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 156, 230, 0.4);
        }

        /* ä¸»ç•Œé¢ */
        .main-container {
            display: none;
            min-height: 100vh;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--space-blue);
        }

        .main-container.active {
            display: block;
        }

        /* ç©ºé—´å¤´éƒ¨ */
        .qzone-header {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid #dce6f2;
            position: relative;
        }

        .qzone-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4c9ce6, #3a87d4);
            border-radius: 8px 8px 0 0;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #4c9ce6;
            overflow: hidden;
            background: linear-gradient(135deg, #4c9ce6 0%, #3a87d4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-placeholder {
            color: white;
            font-size: 28px;
        }

        .profile-info h1 {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .signature {
            color: #666;
            font-size: 13px;
            font-style: italic;
            max-width: 200px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 8px 16px;
            background: linear-gradient(to bottom, #f7f9fc, #e9f0f7);
            color: #333;
            border: 1px solid #c5d9e8;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:hover {
            background: linear-gradient(to bottom, #e9f0f7, #d9e7f5);
            border-color: #4c9ce6;
            color: #4c9ce6;
        }

        .nav-btn.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .lock-icon {
            font-size: 11px;
            color: #999;
        }

        /* æœç´¢å’Œå¤©æ°” */
        .search-weather {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-end;
        }

        .search-box {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search-input {
            padding: 8px 15px;
            border: 1px solid #c5d9e8;
            border-radius: 20px;
            font-size: 13px;
            width: 200px;
            background: white;
            color: #333;
        }

        .search-input:focus {
            outline: none;
            border-color: #4c9ce6;
            box-shadow: 0 0 0 2px rgba(76, 156, 230, 0.2);
        }

        .search-btn {
            padding: 8px 16px;
            background: #4c9ce6;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: #3a87d4;
        }

        .weather-widget {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 11px;
            color: #666;
            background: white;
            padding: 8px 10px;
            border-radius: 6px;
            line-height: 1.4;
            border: 1px solid #dce6f2;
        }

        /* æ—¥å¿—å¡ç‰‡ */
        .diary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .diary-card {
            background: white;
            border-radius: 8px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #dce6f2;
            position: relative;
            overflow: hidden;
        }

        .diary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-color: #4c9ce6;
        }

        .diary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4c9ce6, #3a87d4);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .diary-card:hover::before {
            opacity: 1;
        }

        .diary-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: bold;
        }

        .diary-meta {
            font-size: 11px;
            color: #888;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e8f0f8;
        }

        .diary-preview {
            color: #555;
            font-size: 13px;
            line-height: 1.6;
        }

        .unread-dot {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: white;
            color: #4c9ce6;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border: 1px solid #dce6f2;
        }

        /* å¼¹çª—é€šçŸ¥ */
        .popup-notification {
            position: fixed;
            bottom: 60px;
            right: 15px;
            background: white;
            border-left: 4px solid #4c9ce6;
            border-radius: 6px;
            padding: 12px 16px;
            max-width: 280px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            z-index: 200;
            animation: slideIn 0.3s ease;
            display: none;
            border: 1px solid #dce6f2;
        }

        .popup-notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .popup-close {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
        }

        .popup-close:hover {
            color: #ff6b6b;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 700px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid #dce6f2;
        }

        .modal-header {
            padding: 15px 20px;
            background: linear-gradient(to right, #4c9ce6, #3a87d4);
            color: white;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 16px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
        }

        .modal-body {
            padding: 20px;
        }

        /* å›¾ç‰‡æ ·å¼ */
        .custom-image {
            width: 100%;
            max-width: 400px;
            height: 200px;
            border-radius: 6px;
            margin: 15px auto;
            overflow: hidden;
            border: 1px solid #dce6f2;
            background: #f8fafc;
            position: relative;
        }

        .custom-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            background: linear-gradient(135deg, #f8fafc 0%, #e9f2f9 100%);
        }

        /* å¯ç‚¹å‡»æ–‡å­— */
        .clickable-text {
            color: #4c9ce6;
            text-decoration: none;
            cursor: pointer;
            border-bottom: 1px dashed #4c9ce6;
            padding: 0 2px;
            transition: all 0.2s;
        }

        .clickable-text:hover {
            color: #ff6b6b;
            border-bottom-color: #ff6b6b;
        }

        /* ç›¸å†Œ */
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .album-item {
            aspect-ratio: 1;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid #dce6f2;
            background: #f8fafc;
            transition: all 0.3s;
        }

        .album-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #4c9ce6;
        }

        .album-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .album-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #e9f2f9 100%);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .qzone-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-weather {
                align-items: stretch;
            }
            
            .weather-widget {
                writing-mode: horizontal-tb;
                text-align: center;
                padding: 8px;
            }
            
            .search-box {
                justify-content: center;
            }
            
            .search-input {
                width: 100%;
            }
            
            .diary-section {
                grid-template-columns: 1fr;
            }
            
            .intro-container {
                padding: 20px;
            }

            /* å…¨å±æ¨¡æ€æ¡†æ ·å¼ */
            .modal-overlay.fullscreen .modal-content {
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
                margin: 0;
            }

            .modal-overlay.fullscreen {
                padding: 0;
            }

            .modal-overlay.fullscreen .modal-header {
                border-radius: 0;
                padding: 15px 30px;
            }

            .modal-overlay.fullscreen .modal-body {
                max-height: calc(100vh - 70px);
                overflow-y: auto;
                padding: 30px;
            }

            /* å…¨å±ä¸‹çš„æ—¥è®°å†…å®¹ */
            .modal-overlay.fullscreen .diary-full-content {
                font-size: 16px;
                line-height: 1.8;
                max-width: 800px;
                margin: 0 auto;
            }

            .modal-overlay.fullscreen .custom-image {
                max-width: 600px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- å¼€å§‹é¡µé¢ -->
    <div class="intro-page" id="introPage">
        <div class="intro-container">
            <div class="story-text">
                <p>2024å¹´8æœˆ22æ—¥ä¸‹åˆ5:30ï¼Œé«˜ä¸‰äº”ç­çš„æ•™å®¤é‡Œåªå‰©ä¸‹çƒ¨å­ä¸€ä¸ªäººæ­£åœ¨å†™æ•°å­¦è¯•å·ã€‚çª—å¤–ä¸‹ç€ç»†é›¨ï¼Œè½åˆ°æ ‘å¶ä¸Šå‘å‡ºæ¸…è„†çš„å“å£°ã€‚çƒ¨å­å·²ç»ä¸ºäº†çœ¼å‰çš„è§£æå‡ ä½•èŠ±è´¹äº†ä¸¤é¡µè‰ç¨¿çº¸ã€‚"å–µ"ï¼Œä¸€å£°çŒ«å«çªç„¶æ‰“æ–­äº†å¥¹çš„æ€ç»ªã€‚</p>
                <p>"æ•™å®¤é‡Œæ€ä¹ˆæœ‰çŒ«ï¼Ÿ"çƒ¨å­ç–‘æƒ‘åœ°æŠ¬èµ·å¤´ï¼Œçœ‹è§ä¸€åªç‹¸èŠ±çŒ«ç«¯ç«¯æ­£æ­£åœ°ååœ¨è®²å°ä¸Šã€‚è§çƒ¨å­æ³¨æ„åˆ°äº†å®ƒï¼Œç‹¸èŠ±çŒ«èˆ”äº†èˆ”è‡ªå·±çš„ç™½æ‰‹å¥—ï¼Œå¤§æ­¥æµæ˜Ÿåœ°èµ°åˆ°çƒ¨å­è„šè¾¹ï¼Œè½»ç›ˆåœ°è·³åˆ°å¥¹è…¿ä¸Šã€‚</p>
                <p>"å‘€å°çŒ«ï¼ä½ æ€ä¹ˆçˆ¬åˆ°ä¸‰æ¥¼æ¥äº†ï¼Ÿ"çƒ¨å­æŒ äº†æŒ å°çŒ«çš„è„‘è¢‹ã€‚å¯¹æ–¹åœ¨å¥¹è…¿ä¸Šé€¡å·¡äº†ä¸¤åœˆï¼Œæ²¡æ‰¾åˆ°èˆ’æœçš„ä½ç½®ï¼Œäºæ˜¯åˆè·³åˆ°äº†è¯¾æ¡Œä¸Šã€‚</p>
                <p>æ­£å½“çƒ¨å­ä»¥ä¸ºè‡ªå·±ç»ˆäºå¤ºå›è‡ªå·±çš„åœ°ç›˜çš„æ—¶å€™ï¼Œå°çŒ«çªç„¶è½¬èº«ï¼Œå¼èµ·æ¡Œè¾¹ä¸Šè¢«æŠ˜æˆA5å¤§å°çš„å·å­å¾€æ•™å®¤å¤–è·‘ã€‚</p>
                <p>çƒ¨å­è§çŠ¶åªå¥½è¿½å‡ºå»ï¼š"åçŒ«ï¼å•¥æ„æ€å‘€ï¼Ÿæˆ‘å·å­å†™ä¸€åŠä½ ç»™æˆ‘å¼èµ°äº†ï¼Ÿ"å½“å¥¹å†²å‡ºæ•™å®¤ï¼Œå‘ç°çŒ«æ­£åœåœ¨ä¸è¿œå¤„ï¼Œå°±åƒæ•…æ„ç­‰ç€ä¸€æ ·ã€‚è§å¥¹çœ‹è§äº†è‡ªå·±ï¼Œç‹¸èŠ±æœ‰æ¡ä¸ç´Šåœ°è·‘äº†èµ·æ¥ï¼Œçƒ¨å­è¿½åœ¨å®ƒèº«åï¼Œä¸çŸ¥ä¸è§‰æ¥åˆ°äº†ä¸€ä¸ªç©ºæ•™å®¤é‡Œã€‚</p>
                <p>æ•™å®¤ä¸­é—´æ‘†ç€ä¸€å¥—æ¡Œæ¤…ï¼Œä¸€å°ç”µè„‘åœ¨æ¡Œä¸Šå‘å‡ºå¹½å¹½ç™½å…‰ã€‚çŒ«è·³åˆ°ç”µè„‘è¾¹ï¼ŒæŠŠå·å­å‹åœ¨èº«ä¸‹ï¼Œå«äº†ä¸€å£°ç¤ºæ„çƒ¨å­è¿‡æ¥ã€‚çƒ¨å­å‡‘è¿‡æ¥ï¼Œçœ‹è§ç”µè„‘ä¸Šå¼€ç€ä¸€ä¸ªé™Œç”Ÿç½‘é¡µï¼Œä½†æ˜¯ç™»é™†çš„è´¦å·å´å†™ç€å¥¹ç†Ÿæ‚‰çš„æ˜µç§°â€”â€”Sorrraã€‚</p>
                <p>é‚£æ˜¯å¥¹è‡ªå·±èµ·çš„ã€‚</p>
                <p>çƒ¨å­æœ‰ç‚¹å¥½å¥‡ï¼Œç½‘é¡µå³ä¸‹è§’é€‚æ—¶å¼¹å‡ºæ¥ä¸€ä¸ªå¼¹çª—ï¼š"æœç´¢"åŠŸèƒ½ç°å·²ä¸Šçº¿ï¼Œæ‚¨å¯ä½¿ç”¨å³ä¸Šè§’çš„æœç´¢æ¡†æ£€ç´¢æœªæ˜¾ç¤ºçš„å†…å®¹ã€‚</p>
                <p>å°çŒ«å·²ç»è¶´åœ¨å·å­ä¸Šç¡å¾—æ˜å¤©é»‘åœ°äº†ã€‚çƒ¨å­çœ‹äº†çœ‹è¡¨ï¼Œæƒ³ç€ç¦»æ™šè‡ªä¹ è¿˜æœ‰ä¸€æ®µæ—¶é—´ï¼Œä¾¿å†³å®šæ¢ç´¢ä¸€ä¸‹è¿™ä¸ªå¥‡æ€ªçš„è´¦å·ã€‚</p>
            </div>
            <button class="start-btn" onclick="startGame()">å¼€å§‹æ¢ç´¢</button>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-container" id="mainContainer">
        <div class="qzone-header">
            <div class="profile-section">
                <div class="avatar">
                    <div class="avatar-placeholder">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <div class="profile-info">
                    <h1>Sorrra</h1>
                    <p class="signature">æ¢ç´¢æœªçŸ¥çš„è¾¹ç•Œ</p>
                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="openAlbum()">
                            <i class="fas fa-images"></i> ç›¸å†Œ
                        </button>
                        <button class="nav-btn" onclick="openMusic()">
                            <i class="fas fa-music"></i> éŸ³ä¹
                        </button>
                        <button class="nav-btn locked" id="messageBoardBtn" onclick="tryOpenMessageBoard()">
                            <i class="fas fa-comments"></i> ç•™è¨€æ¿
                            <i class="fas fa-lock lock-icon"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="search-weather">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢å†…å®¹..." onkeypress="handleSearchKeyPress(event)">
                    <button class="search-btn" onclick="performSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="weather-widget">
                    <div>2024å¹´8æœˆ22æ—¥</div>
                    <div>æ·±åœ³ Â· å°é›¨</div>
                    <div>26Â°C</div>
                </div>
            </div>
        </div>

        <!-- æ—¥å¿—å¡ç‰‡ -->
        <div class="diary-section">
            <div class="diary-card" onclick="openDiary('diary1')">
                <div class="unread-dot" id="dot1"></div>
                <div class="diary-meta">
                    <span>2024.12.28 20:33</span>
                    <span>ğŸŒ å…¬å¼€</span>
                </div>
                <h3>éº¦å½“åŠ³</h3>
                <p class="diary-preview">ä»Šå¤©å’Œysyå»åƒäº†éº¦å½“åŠ³ï¼Œè–¯æ¡æˆ‘ä¼šè¿½éšä½ ä¸€è¾ˆå­ï¼Œéº¦é—¨ï¼</p>
            </div>
            <div class="diary-card" onclick="openDiary('diary2')">
                <div class="unread-dot" id="dot2"></div>
                <div class="diary-meta">
                    <span>2024.9.12 23:05</span>
                    <span>ğŸ”’ éƒ¨åˆ†å¯è§</span>
                </div>
                <h3>å°å–éƒ¨</h3>
                <p class="diary-preview">å­¦æ ¡å°å–éƒ¨çš„æ¤°å­æ°´å¥½éš¾æŠ¢ã€‚æ¯æ¬¡è¡¥è´§éƒ½åˆšå¥½æœ‰äººä¸Šä½“è‚²è¯¾...</p>
            </div>
            <div class="diary-card" onclick="openDiary('diary3')">
                <div class="unread-dot" id="dot3"></div>
                <div class="diary-meta">
                    <span>2025.5.30 19:46</span>
                    <span>ğŸŒ å…¬å¼€</span>
                </div>
                <h3>å‚¨ç‰©æŸœ</h3>
                <p class="diary-preview">çœŸä¸æ•¢ç›¸ä¿¡é©¬ä¸Šå°±è¦é«˜è€ƒäº†â€¦â€¦æ—¶é—´è¿‡å¾—çœŸå¿«ã€‚ä»Šå¤©å¼€å§‹æ¸…ç†æŸœå­é‡Œ...</p>
            </div>
        </div>

        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div class="progress-indicator" id="progressIndicator">1/18</div>

        <!-- å¼¹çª—é€šçŸ¥ -->
        <div class="popup-notification" id="popupNotification">
            <button class="popup-close" onclick="closePopup()">Ã—</button>
            <p id="popupText"></p>
        </div>
    </div>

    <!-- æ—¥å¿—æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="diaryModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="diaryTitle">æ—¥å¿—æ ‡é¢˜</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="diaryContent">
                <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- ç›¸å†Œæ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="albumModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2><i class="fas fa-images"></i> ç›¸å†Œ</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="album-grid" id="albumGrid">
                    <div class="album-item" id="albumEmpty">
                        <div class="album-placeholder">æš‚æ— ç…§ç‰‡<br>æ¢ç´¢æ—¥å¿—è§£é”æ›´å¤š</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³ä¹æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="musicModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2><i class="fas fa-music"></i> éŸ³ä¹</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ğŸµ</div>
                    <h3 style="color: #4c9ce6; margin-bottom: 15px;">åæ–¹å‘çš„é’Ÿ</h3>
                    <p style="color: #666; margin-bottom: 20px;">å‘¨æ°ä¼¦ Â· ã€ŠèŒƒç‰¹è¥¿ã€‹</p>
                    <button class="start-btn" style="padding: 10px 30px;" onclick="playMusic()">
                        <i class="fas fa-play"></i> æ’­æ”¾
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentPage: 1,           // å½“å‰æ­£åœ¨æµè§ˆçš„é¡µé¢
            maxPages: 18,            // æ€»é¡µé¢æ•°
            visitedPages: new Set([1]), // å·²è®¿é—®è¿‡çš„é¡µé¢ï¼ˆä¸»ç•Œé¢æ˜¯ç¬¬1é¡µï¼‰
            unlockedDiaries: [],
            messageBoardUnlocked: false,
            albumPhotos: [],
             // é¡µé¢æ˜ å°„ï¼šå“ªä¸ªé¡µé¢æ˜¯ç¬¬å‡ é¡µ
            pageMapping: {
                'main': 1,
                'diary1': 2,
                'diary2': 3,
                'diary3': 4,
                'search_å„¿ç«¥å…¬å›­': 5,
                'search_äººæ°‘å…¬å›­': 6,
                'search_å¥åº·åŠ æ²¹ç«™': 7,
                'search_å¥‡å¦™çš„å›å¿†': 8,
                'search_é«˜ä¸‰ç™¾å®è¢‹': 9,
                'search_ç´§å¼ çš„æ—¥å­': 10,
                'search_æµ·å­çš„è¯—': 11,
                'search_æ­»å‰å¹»æƒ³': 12,
                'search_the blue distant place': 13,
                'search_å¤å¤œæ™šé£': 14,
                'search_æœ€åä¸€å¼ åº•ç‰‡': 15,
                'ending': 16
            }
        };

        // å›¾ç‰‡é…ç½® - åœ¨è¿™é‡Œä¿®æ”¹ä½ çš„å›¾ç‰‡è·¯å¾„
        const imageConfig = {
            diary1: {
                url: 'images/mcd240823.jpg',
                alt: 'éº¦å½“åŠ³ç¾é£Ÿ',
                desc: 'å’Œysyä¸€èµ·åƒçš„éº¦å½“åŠ³'
            },
            diary2: {
                url: 'images/coconut_water.jpg',
                alt: 'æ¤°å­æ°´',
                desc: 'å­¦æ ¡å°å–éƒ¨çš„æ¤°å­æ°´'
            },
            diary3: {
                url: 'images/locker.jpg',
                alt: 'å‚¨ç‰©æŸœ',
                desc: 'é«˜ä¸‰çš„å‚¨ç‰©æŸœ'
            },
            childrenPark: {
                url: 'images/children_park.jpg',
                alt: 'å„¿ç«¥å…¬å›­',
                desc: 'è®°å¿†ä¸­çš„å„¿ç«¥å…¬å›­'
            },
            placeholder: {
                url: '',
                alt: 'å›¾ç‰‡åŠ è½½ä¸­',
                desc: 'ç‚¹å‡»ç¼–è¾‘æ¨¡å¼å¯ä»¥ä¿®æ”¹å›¾ç‰‡é“¾æ¥'
            }
        };

        // æ—¥å¿—å†…å®¹
        const diaryContents = {
            diary1: {
                title: "éº¦å½“åŠ³",
                content: `
                    <p><strong>2024.8.23:</strong></p>
                    <p>ä»Šå¤©å’Œysyå»åƒäº†éº¦å½“åŠ³ï¼Œè–¯æ¡æˆ‘ä¼šè¿½éšä½ ä¸€è¾ˆå­ï¼Œéº¦é—¨ï¼</p>
                    <div class="custom-image" id="diary1Image">
                        <div class="image-placeholder">ğŸŸ éº¦å½“åŠ³ç¾é£Ÿç…§ç‰‡</div>
                    </div>
                    <p><strong>2024.10.31:</strong></p>
                    <p>æœ¬æ¥æ‰“ç®—ä¸åƒæ™šé¥­äº†ï¼Œä½†æ˜¯ysyè¯´ä¸‡åœ£èŠ‚å‡ºäº†æ–°çš„éº¦æ—‹é£ï¼Œé‚£å½“ç„¶æ˜¯è¦å°ä¸€ä¸‹äº†ã€‚æˆ‘é—®ysyåƒå®Œå°±å›å­¦æ ¡å—ï¼Œå¥¹è¯´ä¸æƒ³å›ï¼Œå…¶å®æˆ‘ä¹Ÿä¸æƒ³å›ã€‚"é‚£è¦ä¸æˆ‘ä»¬å»<span class="clickable-text" onclick="showHint('å„¿ç«¥å…¬å›­')">å„¿ç«¥å…¬å›­</span>å§ï¼Œèµ°è·¯å¾ˆå¿«å°±èƒ½åˆ°ã€‚"å¥¹æè®®é“ã€‚</p>
                    <p>å„¿ç«¥å…¬å›­å¾ˆå¤šé¡¹ç›®éƒ½åœæ­¢è¿è¥äº†ï¼Œåªå‰©ä¸‹æ—‹è½¬æœ¨é©¬ã€ç¢°ç¢°è½¦å‡ ä¸ªç»å…¸é¡¹ç›®ä¾›å°å­©å­å¨±ä¹ã€‚å…¬å›­ç®—ä¸ä¸Šå¤ªå¤§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿåªæ˜¯å ªå ªé€›å®Œã€‚ä½œä¸ºé«˜ä¸‰ç”Ÿçš„æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæ—¶é—´å‡ºå»ç©ï¼Œä½†èƒ½å¤Ÿå¶å°”æ‰¾åˆ°è¿™ç§åœ°æ–¹æ”¾æ¾ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å¾ˆä¸é”™äº†ã€‚</p>
                `
            },
            diary2: {
                title: "å°å–éƒ¨",
                content: `
                    <p><strong>2024.9.12 23:05 éƒ¨åˆ†å¯è§</strong></p>
                    <p>å­¦æ ¡å°å–éƒ¨çš„æ¤°å­æ°´å¥½éš¾æŠ¢ã€‚æ¯æ¬¡è¡¥è´§éƒ½åˆšå¥½æœ‰äººä¸Šä½“è‚²è¯¾ï¼Œæ ¹æœ¬æŠ¢ä¸è¿‡ä»–ä»¬ã€‚ä»Šå¤©ä¹°ä¸œè¥¿å¬è§åˆ˜é˜¿å§¨å’Œæé˜¿å§¨åˆšå¥½åœ¨èŠè¿™äº‹ã€‚</p>
                    <p>åˆ˜ï¼š"è¿™æ¤°å­æ°´è¿™ä¹ˆç•…é”€å•Šï¼Œè€å¸ˆå­¦ç”Ÿéƒ½æŠ¢ç€ä¹°ï¼Œæ¯æ¬¡ä¸Šæ¶éƒ½ä¸€ä¸‹æ¸…ç©ºäº†ã€‚"</p>
                    <p>æï¼š"å¯ä¸å˜›ã€‚è¯¶å¯¹äº†ï¼Œæœ€è¿‘å­¦æ ¡æ˜¯ä¸æ˜¯ä¸Šäº†ä¸ªä»€ä¹ˆæµ‹è¯•å¹³å°ï¼Œå«ä»€ä¹ˆâ€¦â€¦<span class="clickable-text" onclick="showHint('å¥åº·åŠ æ²¹ç«™')">å¥åº·åŠ æ²¹ç«™</span>ï¼Ÿè¯´æ˜¯å¯ä»¥ç”¨å·¥å·åœ¨çº¿ä¸Šè´­ä¹°ï¼Œè¿˜å¯ä»¥é¢„è´­éš”å¤©ä¼šä¸Šæ–°çš„å•†å“ã€‚"</p>
                    <p>åˆ˜ï¼š"ä½ è¯´ä¸ä¼šæœ‰äººå·æ‹¿åˆ«äººçš„ä¸œè¥¿å§ï¼Ÿ"</p>
                    <p>æï¼š"è¿™æ”¾å¿ƒå¥½äº†ï¼Œæ‹¿å•†å“ä¹Ÿå¾—åˆ·æ¡ç çš„ï¼Œè¦æ˜¯è¢«é—¨å£æ£€æµ‹ä»ªæŸ¥å‡ºæ¥å·æ‹¿å¯æ˜¯è¦è¢«å–æ¶ˆçº¿ä¸Šè´­ä¹°èµ„æ ¼çš„ï¼Œå¾—ä¸å¿å¤±å˜ã€‚"</p>
                `
            },
            diary3: {
                title: "å‚¨ç‰©æŸœ",
                content: `
                    <p><strong>2025.5.30 19:46 å…¬å¼€</strong></p>
                    <p>çœŸä¸æ•¢ç›¸ä¿¡é©¬ä¸Šå°±è¦é«˜è€ƒäº†â€¦â€¦æ—¶é—´è¿‡å¾—çœŸå¿«ã€‚</p>
                    <p>ä»Šå¤©å¼€å§‹æ¸…ç†æŸœå­é‡Œï¼Œä¸œè¥¿å¥½å¤šå•Šï¼Œæˆ‘è¿˜åˆ—äº†ä¸ªæ¸…å•æ¥çœ‹è‡ªå·±éƒ½æ”¾äº†äº›å•¥ã€‚</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0;">
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; text-align: center; cursor: pointer; border: 1px solid #dce6f2;" onclick="showItemDetail('æ•™ç§‘ä¹¦')">
                            <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“š</div>
                            <div style="font-size: 13px;">æ•™ç§‘ä¹¦</div>
                        </div>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; text-align: center; cursor: pointer; border: 1px solid #dce6f2;" onclick="showItemDetail('é›¶é£Ÿ')">
                            <div style="font-size: 24px; margin-bottom: 8px;">ğŸ¬</div>
                            <div style="font-size: 13px;">é›¶é£Ÿ</div>
                        </div>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; text-align: center; cursor: pointer; border: 1px solid #dce6f2;" onclick="showItemDetail('ç…§ç‰‡')">
                            <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“·</div>
                            <div style="font-size: 13px;">ç…§ç‰‡</div>
                        </div>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; text-align: center; cursor: pointer; border: 1px solid #dce6f2;" onclick="showItemDetail('å›å¿†')">
                            <div style="font-size: 24px; margin-bottom: 8px;">ğŸ’­</div>
                            <div style="font-size: 13px;">å›å¿†</div>
                        </div>
                    </div>
                `
            }
        };

        // æœç´¢å…³é”®è¯å¯¹åº”çš„é¡µé¢
        const searchPages = {
            'å„¿ç«¥å…¬å›­': {
                title: 'åŸå¸‚æ–°é—»',
                content: `
                    <div style="background: white; border-radius: 6px; padding: 20px; border: 1px solid #dce6f2;">
                        <h3 style="color: #4c9ce6; margin-bottom: 15px;">åŸå¸‚ç„•æ–°é¢œï¼šä¸­å¿ƒå„¿ç«¥å…¬å›­å°†äº2024å¹´11æœˆå¯åŠ¨å…¨é¢æ”¹é€ </h3>
                        <p style="line-height: 1.8; margin-bottom: 15px;">æœ¬å¸‚è®¯ï¼šä¸ºè¿›ä¸€æ­¥æå‡åŸå¸‚å…¬å…±ç©ºé—´å“è´¨ï¼Œæ»¡è¶³å¸‚æ°‘æ—¥ç›Šå¢é•¿çš„ä¼‘é—²å¨±ä¹éœ€æ±‚ï¼Œå¸‚å›­æ—ä¸ç»¿åŒ–ç®¡ç†å±€ä»Šæ—¥æ­£å¼å®£å¸ƒï¼Œä½äºåŸå¸‚æ ¸å¿ƒåŒºçš„æ ‡å¿—æ€§åœºæ‰€â€”â€”ä¸­å¿ƒå„¿ç«¥å…¬å›­ï¼Œå°†äº2024å¹´11æœˆ1æ—¥èµ·å®æ–½ä¸ºæœŸä¸€å¹´çš„å…¨é¢å°é—­æ”¹é€ å‡çº§å·¥ç¨‹ã€‚</p>
                        <p style="line-height: 1.8; margin-bottom: 15px;">ä¸­å¿ƒå„¿ç«¥å…¬å›­å§‹å»ºäº1987å¹´ï¼Œè¿‘å››åå¹´æ¥ä¸€ç›´æ˜¯æœ¬å¸‚å®¶åº­å‘¨æœ«ä¼‘é—²çš„é¦–é€‰ä¹‹åœ°ã€‚å›­å†…é‚£åº§æ ‡å¿—æ€§çš„å¤§è±¡æ»‘æ¢¯å’Œæ–‘é©³çš„ç§‹åƒæ¶ï¼Œç•™å­˜äº†æ— æ•°å¸‚æ°‘çš„ç«¥å¹´å‰ªå½±ã€‚</p>
                        <p style="line-height: 1.8; margin-bottom: 15px;">é’ˆå¯¹å¸‚æ°‘å…³å¿ƒçš„å…¬å›­å°é—­æœŸé—´çš„ä¼‘é—²éœ€æ±‚ï¼Œå»ºè®®å¸‚æ°‘å¯ä»¥å‰å¾€ä½äºäººæ°‘åŒ—è·¯3071å·çš„<span class="clickable-text" onclick="showHint('äººæ°‘å…¬å›­')">äººæ°‘å…¬å›­</span>è¿›è¡Œä¼‘é—²å¨±ä¹æ´»åŠ¨ã€‚</p>
                    </div>
                `,
                progress: 5
            },
            'äººæ°‘å…¬å›­': {
                title: 'æ—¥å¿— - äººæ°‘å…¬å›­',
                content: `
                    <p><strong>2024.11.15 23:17 å…¬å¼€</strong></p>
                    <p>åŸæ¥å„¿ç«¥å…¬å›­è¦é—­é—¨æ”¹é€ äº†å•Šï¼Œéš¾æ€ªå¾ˆå¤šè®¾æ–½éƒ½ç”¨ä¸äº†äº†ã€‚å¥½å¯æƒœï¼Œåˆå°‘äº†ä¸€ä¸ªå¯ä»¥å»æ”¾æ¾çš„åœ°æ–¹ã€‚å¶ç„¶å»ä¸€æ¬¡æ²¡æƒ³åˆ°éš”å¤©å®ƒå°±è¦å…³é—¨äº†ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§ç¼˜åˆ†äº†ã€‚</p>
                    <div class="custom-image" id="parkImage">
                        <div class="image-placeholder">ğŸ  å„¿ç«¥å…¬å›­ç…§ç‰‡</div>
                    </div>
                    <p>ä¸€å‘¨å‰ç­ä¸»ä»»å°±è¯´è®¡åˆ’ä»Šå¤©å»äººæ°‘å…¬å›­ç§‹æ¸¸çš„ï¼Œæ²¡æƒ³åˆ°ä»Šå¤©ä¸‹é›¨äº†ã€‚è™½ç„¶åˆ°æœ€åéƒ½è¿˜ä¸‹ç€ä¸€ç‚¹ç‚¹é›¨ï¼Œä½†æ˜¯ç­ä¸»ä»»è¿˜æ˜¯æ”¾æˆ‘ä»¬å»äº†ã€‚</p>
                    <p>ä»Šå¤©ä¸­åˆè·Ÿstyqåƒé¥­çš„æ—¶å€™å¥¹è¯´ç§‹æ¸¸è¿™ä¸ªå»ºè®®è¿˜æ˜¯å¥¹ä»¬ç­ä¸»ä»»æœ€å…ˆæå‡ºæ¥çš„ï¼Œè°æ˜¯äººæ°‘çš„å¥½è€å¸ˆæˆ‘ä¸€çœ‹ä¾¿çŸ¥ï¼Œæ„Ÿè°¢jwyï¼</p>
                `,
                progress: 6
            },
            'å¥åº·åŠ æ²¹ç«™': {
                title: 'å¥åº·åŠ æ²¹ç«™',
                content: `
                    <div style="text-align: center;">
                        <div style="background: linear-gradient(to right, #4c9ce6, #3a87d4); color: white; padding: 20px; border-radius: 6px 6px 0 0; margin-bottom: 20px;">
                            <h3>ğŸ¥ å¥åº·åŠ æ²¹ç«™</h3>
                            <p>åœ¨çº¿è´­ä¹°ï¼Œä¾¿æ·å–è´§</p>
                        </div>
                        <p style="color: #666; margin-bottom: 30px;">åŠŸèƒ½å¼€å‘ä¸­... å¯ä»¥æœç´¢<span class="clickable-text" onclick="showHint('å¥‡å¦™çš„å›å¿†')">"å¥‡å¦™çš„å›å¿†"</span>ç»§ç»­æ¢ç´¢</p>
                    </div>
                `,
                progress: 7
            },
            'å¥‡å¦™çš„å›å¿†': {
                title: 'æ—¥å¿— - å¥‡å¦™çš„å›å¿†',
                content: `
                    <p><strong>2025.1.20 23:40 å…¬å¼€</strong></p>
                    <p>é«˜ä¸‰è¿˜èƒ½æœ‰ä½“è‚²è¯¾ä¹Ÿæ˜¯å¾ˆéš¾å¾—äº†ã€‚è‡ªç”±æ—¶é—´æ¥ä¹‹ä¸æ˜“ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å°±æ²¡æœ‰ä¸ç¿˜è¯¾çš„ç†ç”±ã€‚</p>
                    <p>å°å–éƒ¨å’Œä½“è‚²åœºåœ¨åŒä¸€æ¡è·¯ä¸Šï¼Œå¤§å¤§æ–¹ä¾¿äº†ä¸Šä½“è‚²è¯¾çš„äººå»ä¹°ä¸œè¥¿ã€‚å·§å…‹åŠ›æ£’å’Œå¥è¾¾å¥‡è¶£è›‹è¿™ç§ç”œé£Ÿæ€»æ˜¯å¾ˆå®¹æ˜“å”®ç©ºã€‚æ£‰èŠ±ç³–å¥½åƒï¼Œä½†æ˜¯éƒ½æ˜¯å¤§ç›’å¤§ç›’å”®å–ï¼Œä¹°çš„äººä¹Ÿå°±å°‘äº†ã€‚</p>
                    <p>ç”Ÿæ—¥çš„æ—¶å€™ysyé€äº†æˆ‘ä¸€ç›’çƒ¤æ£‰èŠ±ç³–ï¼Œä¸€ç›´éƒ½æ²¡æ‰¾åˆ°æœºä¼šæŠŠå®ƒæ¶ˆåŒ–æ‰ï¼Œæ­£å·§ä»Šå¤©ä½“è‚²è¯¾æƒ³èµ·æ¥äº†ã€‚ç…¤å—åœ¨é”¡çº¸ä¸Šæ»‹æ»‹ä½œå“ï¼Œæ£‰èŠ±ç³–è¢«çƒ¤å‡ºäº†ç„¦é»„çš„çš®ï¼Œçƒ­çƒ­çš„ï¼Œå’¬ä¸‹å»çš„å£æ„Ÿå¾ˆç¥å¥‡ã€‚</p>
                    <p>é«˜ä¸­ç”Ÿçš„ä¹è¶£å¯èƒ½å°±æ˜¯å¾ˆç®€å•ï¼Œåƒåˆ°çƒ¤æ£‰èŠ±ç³–ï¼Œæ’åæœ‰æ˜¾è‘—è¿›å±•ï¼Œè¦æ˜¯èƒ½å¤Ÿä¸€æ¬¡æ€§ä¹°åˆ°å°å–éƒ¨å››ç§ç‚™æ‰‹å¯çƒ­çš„å•†å“ï¼Œé‚£å¯æ˜¯èƒ½å¤Ÿå¹å¥½ä¸€é˜µäº†ã€‚ç‚¹å‡»æŸ¥çœ‹<span class="clickable-text" onclick="showHint('é«˜ä¸‰ç™¾å®è¢‹')">é«˜ä¸‰ç™¾å®è¢‹</span>ï¼</p>
                `,
                progress: 8
            }
        };

        // åˆå§‹åŒ–
        function init() {
            updateProgress();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('introPage').style.display = 'none';
            document.getElementById('mainContainer').classList.add('active');
            setCurrentPage('main');
            showPopup('åº”å¹¿å¤§ç”¨æˆ·è¦æ±‚ï¼Œ"æœç´¢"åŠŸèƒ½ç°å·²ä¸Šçº¿ï¼æ‚¨å¯ä½¿ç”¨å³ä¸Šè§’çš„æœç´¢æ¡†æ£€ç´¢æœªæ˜¾ç¤ºçš„å†…å®¹ã€‚');
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            document.getElementById('progressIndicator').textContent = `${gameState.currentPage}/${gameState.maxPages}`;
        }

        function setCurrentPage(pageId) {
            // æ ¹æ®é¡µé¢IDè®¾ç½®å½“å‰é¡µæ•°
            const pageNum = gameState.pageMapping[pageId] || gameState.currentPage;
            gameState.currentPage = pageNum;
            gameState.visitedPages.add(pageNum);
            updateProgress();
        }

        // æ˜¾ç¤ºå¼¹çª—
        function showPopup(text) {
            const popup = document.getElementById('popupNotification');
            document.getElementById('popupText').textContent = text;
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        function closePopup() {
            document.getElementById('popupNotification').classList.remove('show');
        }

        // æ‰“å¼€æ—¥å¿—
        function openDiary(diaryId) {
            const diary = diaryContents[diaryId];
            if (!diary) return;

            // æ›´æ–°é¡µé¢è¿›åº¦ï¼ˆæ—¥è®°å¯¹åº”ç¬¬2ã€3ã€4é¡µï¼‰
            setCurrentPage(diaryId);  // diary1 -> ç¬¬2é¡µï¼Œdiary2 -> ç¬¬3é¡µï¼Œdiary3 -> ç¬¬4é¡µ
    
            // éšè—çº¢ç‚¹ï¼ˆåªç¬¬ä¸€æ¬¡ï¼‰
            if (!gameState.unlockedDiaries.includes(diaryId)) {
                gameState.unlockedDiaries.push(diaryId);
                const dot = document.getElementById('dot' + diaryId.replace('diary', ''));
                if (dot) dot.style.display = 'none';
            }

            // è®¾ç½®æ¨¡æ€æ¡†ä¸ºå…¨å±æ ·å¼
            document.getElementById('diaryModal').classList.add('fullscreen');
            document.getElementById('diaryTitle').textContent = diary.title;
            document.getElementById('diaryContent').innerHTML = diary.content;
    
            // åŠ è½½å›¾ç‰‡
            setTimeout(() => {
                loadImage(diaryId + 'Image', diaryId);
            }, 100);

            // æ·»åŠ åˆ°ç›¸å†Œ
            addToAlbum(diaryId);

            // æ‰“å¼€æ¨¡æ€æ¡†
            openModal('diaryModal');
        }

        // åŠ è½½å›¾ç‰‡
        function loadImage(elementId, imageKey) {
            const imgConfig = imageConfig[imageKey] || imageConfig.placeholder;
            const element = document.getElementById(elementId);
            
            if (element && imgConfig.url && imgConfig.url.trim() !== '') {
                element.innerHTML = `<img src="${imgConfig.url}" alt="${imgConfig.alt}" title="${imgConfig.desc}">`;
            }
        }

        // æ˜¾ç¤ºç‰©å“è¯¦æƒ…
        function showItemDetail(item) {
            const details = {
                'æ•™ç§‘ä¹¦': 'ğŸ“š åšåšçš„æ•™ç§‘ä¹¦ï¼Œæ‰¿è½½äº†æ— æ•°ä¸ªæ—¥å¤œçš„åŠªåŠ›å’Œæ±—æ°´ã€‚',
                'é›¶é£Ÿ': 'ğŸ¬ è—åœ¨æŸœå­è§’è½çš„é›¶é£Ÿï¼Œæ˜¯è¯¾é—´çš„å°ç¡®å¹¸ã€‚',
                'ç…§ç‰‡': 'ğŸ“· å’Œæœ‹å‹ä»¬çš„åˆç…§ï¼Œæ¯ä¸€å¼ éƒ½æ˜¯çè´µçš„å›å¿†ã€‚',
                'å›å¿†': 'ğŸ’­ è¿™äº›ä¸œè¥¿æ‰¿è½½çš„ä¸åªæ˜¯ç‰©å“ï¼Œæ›´æ˜¯ä¸€æ®µé’æ˜¥ã€‚'
            };
            showPopup(details[item] || 'æœªçŸ¥ç‰©å“');
        }

        // æ˜¾ç¤ºæç¤º
        function showHint(keyword) {
            showPopup(`æç¤ºï¼šå°è¯•æœç´¢"${keyword}"`);
        }

        // å¤„ç†æœç´¢
        function performSearch() {
            const input = document.getElementById('searchInput');
            const query = input.value.trim().toLowerCase();
            input.value = '';

            if (!query) {
                showPopup('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦åŒ¹é…å…³é”®è¯
            for (const [key, page] of Object.entries(searchPages)) {
                if (query === key.toLowerCase()) {
                    // æ›´æ–°è¿›åº¦
                    if (page.progress && !gameState.unlockedDiaries.includes('search_' + page.progress)) {
                        gameState.unlockedDiaries.push('search_' + page.progress);
                        gameState.progress = Math.max(gameState.progress, page.progress);
                        updateProgress();
                    }

                    // æ˜¾ç¤ºé¡µé¢
                    document.getElementById('diaryTitle').textContent = page.title;
                    document.getElementById('diaryContent').innerHTML = page.content;
                    
                    // åŠ è½½å›¾ç‰‡
                    if (key === 'äººæ°‘å…¬å›­') {
                        setTimeout(() => {
                            loadImage('parkImage', 'childrenPark');
                        }, 100);
                    }
                    
                    openModal('diaryModal');
                    return;
                }
            }

            // æ²¡æœ‰åŒ¹é…
            showPopup('æœªæ‰¾åˆ°ç›¸å…³å†…å®¹ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯');
        }

        // å¤„ç†å›è½¦æœç´¢
        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        // æ‰“å¼€ç›¸å†Œ
        function openAlbum() {
            updateAlbum();
            openModal('albumModal');
        }

        // æ›´æ–°ç›¸å†Œ
        function updateAlbum() {
            const albumGrid = document.getElementById('albumGrid');
            albumGrid.innerHTML = '';

            if (gameState.albumPhotos.length === 0) {
                albumGrid.innerHTML = `
                    <div class="album-item" id="albumEmpty">
                        <div class="album-placeholder">æš‚æ— ç…§ç‰‡<br>æ¢ç´¢æ—¥å¿—è§£é”æ›´å¤š</div>
                    </div>
                `;
                return;
            }

            gameState.albumPhotos.forEach(photoId => {
                const imgConfig = imageConfig[photoId] || imageConfig.placeholder;
                const albumItem = document.createElement('div');
                albumItem.className = 'album-item';
                albumItem.onclick = () => viewPhoto(photoId);
                
                if (imgConfig.url && imgConfig.url.trim() !== '') {
                    albumItem.innerHTML = `<img src="${imgConfig.url}" alt="${imgConfig.alt}" class="album-img">`;
                } else {
                    albumItem.innerHTML = `<div class="album-placeholder">${imgConfig.alt}</div>`;
                }
                
                albumGrid.appendChild(albumItem);
            });
        }

        // æ·»åŠ åˆ°ç›¸å†Œ
        function addToAlbum(photoId) {
            if (!gameState.albumPhotos.includes(photoId)) {
                gameState.albumPhotos.push(photoId);
            }
        }

        // æŸ¥çœ‹ç…§ç‰‡
        function viewPhoto(photoId) {
            const imgConfig = imageConfig[photoId] || imageConfig.placeholder;
            document.getElementById('diaryTitle').textContent = imgConfig.alt;
            let content = `<div style="text-align: center;">`;
            
            if (imgConfig.url && imgConfig.url.trim() !== '') {
                content += `<img src="${imgConfig.url}" alt="${imgConfig.alt}" style="max-width: 100%; max-height: 400px; border-radius: 8px; margin-bottom: 20px;">`;
            } else {
                content += `<div class="image-placeholder" style="height: 300px; margin-bottom: 20px;">${imgConfig.alt}</div>`;
            }
            
            content += `<p style="color: #666;">${imgConfig.desc}</p></div>`;
            
            document.getElementById('diaryContent').innerHTML = content;
            openModal('diaryModal');
        }

        // æ‰“å¼€éŸ³ä¹
        function openMusic() {
            openModal('musicModal');
        }

        function playMusic() {
            showPopup('éŸ³ä¹æ’­æ”¾ä¸­... æ­Œæ›²ï¼šã€Šåæ–¹å‘çš„é’Ÿã€‹');
        }

        // å°è¯•æ‰“å¼€ç•™è¨€æ¿
        function tryOpenMessageBoard() {
            if (gameState.progress >= 13) {
                gameState.messageBoardUnlocked = true;
                document.getElementById('messageBoardBtn').classList.remove('locked');
                showPopup('ç•™è¨€æ¿å·²è§£é”ï¼');
                // è¿™é‡Œå¯ä»¥æ·»åŠ æ‰“å¼€ç•™è¨€æ¿çš„é€»è¾‘
            } else {
                showPopup('ç•™è¨€æ¿å°šæœªè§£é”ï¼Œç»§ç»­æ¢ç´¢å§ï¼');
            }
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(event) {
            if (event && event.target.classList.contains('modal-overlay')) {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                    modal.classList.remove('fullscreen'); // ç§»é™¤å…¨å±æ ·å¼
                });
                // è¿”å›ä¸»ç•Œé¢æ—¶ï¼Œè®¾ç½®å½“å‰é¡µä¸ºç¬¬1é¡µ
                setCurrentPage('main');
            } else {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                    modal.classList.remove('fullscreen');
                });
                setCurrentPage('main');
            }
        }

        // åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>