<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è“è‰²è¿œæ–¹ - The Blue Distant Place</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600&family=ZCOOL+KuaiLe&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ä¿ç•™åŸæœ‰çš„æ‰€æœ‰CSSæ ·å¼ï¼Œè¿™é‡Œåªæ·»åŠ æ–°çš„æ ·å¼ */
        
        /* æ–°æ·»åŠ ï¼šå›¾ç‰‡å®¹å™¨æ ·å¼ */
        .custom-image {
            width: 100%;
            max-width: 400px;
            height: 250px;
            border-radius: 12px;
            margin: 20px auto;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            position: relative;
            border: 2px solid var(--border-color);
        }
        
        .custom-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-placeholder {
            color: var(--text-secondary);
            font-style: italic;
            padding: 20px;
            text-align: center;
        }
        
        /* ç›¸å†Œå›¾ç‰‡æ ·å¼ */
        .album-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .album-img:hover {
            transform: scale(1.05);
        }
        
        /* ä¿®å¤å¼€å§‹æŒ‰é’®ç‚¹å‡»åŒºåŸŸ */
        .start-btn {
            margin-top: 25px;
            padding: 15px 50px;
            background: linear-gradient(135deg, #4a90d9 0%, #357abd 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-family: 'ZCOOL KuaiLe', cursive;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(74, 144, 217, 0.4);
            z-index: 10;
            position: relative;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(74, 144, 217, 0.6);
        }
    </style>
</head>
<body>
    <!-- Edit Mode Toggle -->
    <button class="edit-mode-toggle" onclick="toggleEditMode()" title="åˆ‡æ¢ç¼–è¾‘æ¨¡å¼">
        <i class="fas fa-edit"></i> ç¼–è¾‘æ¨¡å¼
    </button>

    <!-- Intro Page -->
    <div class="intro-page" id="introPage">
        <div class="classroom-scene">
            <div class="rain-overlay"></div>
            <div class="clock"></div>
            <div class="blackboard">
                <span class="blackboard-text">é«˜ä¸‰äº”ç­ åŠ æ²¹ï¼</span>
            </div>
            <div class="desk">
                <div class="desk-items">
                    <div class="paper"></div>
                    <div class="paper"></div>
                </div>
            </div>
            <div class="cat-on-desk">ğŸ±</div>
        </div>
        <div class="story-text editable-content" data-key="introStory">
            <p>2024å¹´8æœˆ22æ—¥ä¸‹åˆ5:30ï¼Œé«˜ä¸‰äº”ç­çš„æ•™å®¤é‡Œåªå‰©ä¸‹çƒ¨å­ä¸€ä¸ªäººæ­£åœ¨å†™æ•°å­¦è¯•å·ã€‚çª—å¤–ä¸‹ç€ç»†é›¨ï¼Œè½åˆ°æ ‘å¶ä¸Šå‘å‡ºæ¸…è„†çš„å“å£°ã€‚çƒ¨å­å·²ç»ä¸ºäº†çœ¼å‰çš„è§£æå‡ ä½•èŠ±è´¹äº†ä¸¤é¡µè‰ç¨¿çº¸ã€‚"å–µ"ï¼Œä¸€å£°çŒ«å«çªç„¶æ‰“æ–­äº†å¥¹çš„æ€ç»ªã€‚</p>
            <p>"æ•™å®¤é‡Œæ€ä¹ˆæœ‰çŒ«ï¼Ÿ"çƒ¨å­ç–‘æƒ‘åœ°æŠ¬èµ·å¤´ï¼Œçœ‹è§ä¸€åªç‹¸èŠ±çŒ«ç«¯ç«¯æ­£æ­£åœ°ååœ¨è®²å°ä¸Šã€‚è§çƒ¨å­æ³¨æ„åˆ°äº†å®ƒï¼Œç‹¸èŠ±çŒ«èˆ”äº†èˆ”è‡ªå·±çš„ç™½æ‰‹å¥—ï¼Œå¤§æ­¥æµæ˜Ÿåœ°èµ°åˆ°çƒ¨å­è„šè¾¹ï¼Œè½»ç›ˆåœ°è·³åˆ°å¥¹è…¿ä¸Šã€‚</p>
            <p>"å‘€å°çŒ«ï¼ä½ æ€ä¹ˆçˆ¬åˆ°ä¸‰æ¥¼æ¥äº†ï¼Ÿ"æ­£å½“çƒ¨å­ä»¥ä¸ºè‡ªå·±ç»ˆäºå¤ºå›è‡ªå·±çš„åœ°ç›˜çš„æ—¶å€™ï¼Œå°çŒ«çªç„¶è½¬èº«ï¼Œå¼èµ·æ¡Œè¾¹ä¸Šè¢«æŠ˜æˆA5å¤§å°çš„å·å­å¾€æ•™å®¤å¤–è·‘ã€‚</p>
            <p>çƒ¨å­è§çŠ¶åªå¥½è¿½å‡ºå»ã€‚å½“å¥¹å†²å‡ºæ•™å®¤ï¼Œå‘ç°çŒ«æ­£åœåœ¨ä¸è¿œå¤„ï¼Œå°±åƒæ•…æ„ç­‰ç€ä¸€æ ·ã€‚ä¸çŸ¥ä¸è§‰æ¥åˆ°äº†ä¸€ä¸ªç©ºæ•™å®¤é‡Œï¼Œä¸€å°ç”µè„‘åœ¨æ¡Œä¸Šå‘å‡ºå¹½å¹½ç™½å…‰ã€‚ç”µè„‘ä¸Šå¼€ç€ä¸€ä¸ªé™Œç”Ÿç½‘é¡µï¼Œä½†æ˜¯ç™»é™†çš„è´¦å·å´å†™ç€å¥¹ç†Ÿæ‚‰çš„æ˜µç§°â€”â€”Sorrraã€‚</p>
        </div>
        <button class="start-btn" onclick="startGame()">å¼€å§‹æ¢ç´¢</button>
    </div>

    <!-- ä»¥ä¸‹æ˜¯åŸæœ‰çš„HTMLç»“æ„ï¼Œä¿æŒä¸å˜ -->
    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <!-- ... åŸæœ‰çš„HTMLä»£ç ä¿æŒä¸å˜ ... -->
    </div>

    <script>
        // ==================== å›¾ç‰‡é…ç½® ====================
        // åœ¨è¿™é‡Œé…ç½®ä½ è‡ªå·±çš„å›¾ç‰‡è·¯å¾„
        const imageConfig = {
            // æ—¥å¿—å›¾ç‰‡
            diary1: {
                url: 'images/mcdonalds.jpg', // æ›¿æ¢ä¸ºä½ çš„éº¦å½“åŠ³å›¾ç‰‡è·¯å¾„
                alt: 'éº¦å½“åŠ³ç¾é£Ÿ',
                desc: 'å’Œysyä¸€èµ·åƒçš„éº¦å½“åŠ³'
            },
            diary2: {
                url: 'images/coconut_water.jpg', // æ›¿æ¢ä¸ºä½ çš„å°å–éƒ¨å›¾ç‰‡
                alt: 'æ¤°å­æ°´',
                desc: 'å­¦æ ¡å°å–éƒ¨çš„æ¤°å­æ°´'
            },
            diary3: {
                url: 'images/locker.jpg', // æ›¿æ¢ä¸ºå‚¨ç‰©æŸœå›¾ç‰‡
                alt: 'å‚¨ç‰©æŸœ',
                desc: 'é«˜ä¸‰çš„å‚¨ç‰©æŸœ'
            },
            childrenPark: {
                url: 'images/children_park.jpg', // å„¿ç«¥å…¬å›­å›¾ç‰‡
                alt: 'å„¿ç«¥å…¬å›­',
                desc: 'è®°å¿†ä¸­çš„å„¿ç«¥å…¬å›­'
            },
            peoplePark: {
                url: 'images/people_park.jpg', // äººæ°‘å…¬å›­å›¾ç‰‡
                alt: 'äººæ°‘å…¬å›­',
                desc: 'ç§‹æ¸¸çš„äººæ°‘å…¬å›­'
            },
            ocPhoto: {
                url: 'images/oc_photo.jpg', // OCç…§ç‰‡
                alt: 'OCæ‘„å½±',
                desc: 'ä¸ºOCæ‹çš„ç…§ç‰‡'
            },
            basketball: {
                url: 'images/basketball.jpg', // ç¯®çƒèµ›ç…§ç‰‡
                alt: 'ç¯®çƒèµ›',
                desc: 'å­¦æ ¡ç¯®çƒèµ›'
            },
            poemActivity: {
                url: 'images/poem_activity.jpg', // ä»¥è¯—æ¢è¯—æ´»åŠ¨
                alt: 'è¯—æ­Œæ´»åŠ¨',
                desc: 'ä»¥è¯—æ¢è¯—æ´»åŠ¨ç…§ç‰‡'
            },
            uniSky: {
                url: 'images/uni_sky.jpg', // å¤§å­¦å¤©ç©º
                alt: 'å¤§å­¦å¤©ç©º',
                desc: 'å¤§å­¦å®¿èˆçª—å¤–çš„è“å¤©'
            },
            // é»˜è®¤å ä½å›¾ç‰‡ï¼ˆå¦‚æœæŸå¼ å›¾ç‰‡æ²¡æœ‰ï¼Œä¼šæ˜¾ç¤ºè¿™ä¸ªï¼‰
            placeholder: {
                url: '',
                alt: 'å›¾ç‰‡åŠ è½½ä¸­',
                desc: 'ç‚¹å‡»ç¼–è¾‘æ¨¡å¼å¯ä»¥ä¿®æ”¹å›¾ç‰‡é“¾æ¥'
            }
        };

        // ==================== ä¿®æ”¹çš„æ—¥è®°å†…å®¹ ====================
        // ç”¨è‡ªå®šä¹‰å›¾ç‰‡æ›¿æ¢åŸæ¥çš„çº¯è‰²èƒŒæ™¯
        editableContent.diary1Content = `<p><strong>2024.8.23:</strong></p>
            <p>ä»Šå¤©å’Œysyå»åƒäº†éº¦å½“åŠ³ï¼Œè–¯æ¡æˆ‘ä¼šè¿½éšä½ ä¸€è¾ˆå­ï¼Œéº¦é—¨ï¼</p>
            <div class="custom-image" id="mcdonaldsImage">
                <div class="image-placeholder">ğŸŸ éº¦å½“åŠ³ç¾é£Ÿç…§ç‰‡</div>
            </div>
            <p><strong>2024.10.31:</strong></p>
            <p>æœ¬æ¥æ‰“ç®—ä¸åƒæ™šé¥­äº†ï¼Œä½†æ˜¯ysyè¯´ä¸‡åœ£èŠ‚å‡ºäº†æ–°çš„éº¦æ—‹é£ï¼Œé‚£å½“ç„¶æ˜¯è¦å°ä¸€ä¸‹äº†ã€‚æˆ‘é—®ysyåƒå®Œå°±å›å­¦æ ¡å—ï¼Œå¥¹è¯´ä¸æƒ³å›ï¼Œå…¶å®æˆ‘ä¹Ÿä¸æƒ³å›ã€‚"é‚£è¦ä¸æˆ‘ä»¬å»<span class="clickable-text" onclick="showHint('å„¿ç«¥å…¬å›­')">å„¿ç«¥å…¬å›­</span>å§ï¼Œèµ°è·¯å¾ˆå¿«å°±èƒ½åˆ°ã€‚"å¥¹æè®®é“ã€‚</p>
            <p>å„¿ç«¥å…¬å›­å¾ˆå¤šé¡¹ç›®éƒ½åœæ­¢è¿è¥äº†ï¼Œåªå‰©ä¸‹æ—‹è½¬æœ¨é©¬ã€ç¢°ç¢°è½¦å‡ ä¸ªç»å…¸é¡¹ç›®ä¾›å°å­©å­å¨±ä¹ã€‚å…¬å›­ç®—ä¸ä¸Šå¤ªå¤§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿåªæ˜¯å ªå ªé€›å®Œã€‚ä½œä¸ºé«˜ä¸‰ç”Ÿçš„æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæ—¶é—´å‡ºå»ç©ï¼Œä½†èƒ½å¤Ÿå¶å°”æ‰¾åˆ°è¿™ç§åœ°æ–¹æ”¾æ¾ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å¾ˆä¸é”™äº†ã€‚</p>`;

        editableContent.page6Content = `<p><strong>2024.11.15 23:17 å…¬å¼€</strong></p>
            <p>åŸæ¥å„¿ç«¥å…¬å›­è¦é—­é—¨æ”¹é€ äº†å•Šï¼Œéš¾æ€ªå¾ˆå¤šè®¾æ–½éƒ½ç”¨ä¸äº†äº†ã€‚å¥½å¯æƒœï¼Œåˆå°‘äº†ä¸€ä¸ªå¯ä»¥å»æ”¾æ¾çš„åœ°æ–¹ã€‚å¶ç„¶å»ä¸€æ¬¡æ²¡æƒ³åˆ°éš”å¤©å®ƒå°±è¦å…³é—¨äº†ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§ç¼˜åˆ†äº†ã€‚</p>
            <div class="custom-image" id="childrenParkImage">
                <div class="image-placeholder">ğŸ  å„¿ç«¥å…¬å›­ç…§ç‰‡</div>
            </div>
            <p>ä¸€å‘¨å‰ç­ä¸»ä»»å°±è¯´è®¡åˆ’ä»Šå¤©å»äººæ°‘å…¬å›­ç§‹æ¸¸çš„ï¼Œæ²¡æƒ³åˆ°ä»Šå¤©ä¸‹é›¨äº†ã€‚è™½ç„¶åˆ°æœ€åéƒ½è¿˜ä¸‹ç€ä¸€ç‚¹ç‚¹é›¨ï¼Œä½†æ˜¯ç­ä¸»ä»»è¿˜æ˜¯æ”¾æˆ‘ä»¬å»äº†ã€‚</p>
            <p>ä»Šå¤©ä¸­åˆè·Ÿstyqåƒé¥­çš„æ—¶å€™å¥¹è¯´ç§‹æ¸¸è¿™ä¸ªå»ºè®®è¿˜æ˜¯å¥¹ä»¬ç­ä¸»ä»»æœ€å…ˆæå‡ºæ¥çš„ï¼Œè°æ˜¯äººæ°‘çš„å¥½è€å¸ˆæˆ‘ä¸€çœ‹ä¾¿çŸ¥ï¼Œæ„Ÿè°¢jwyï¼</p>`;

        // ==================== æ–°å¢å‡½æ•°ï¼šåŠ è½½å›¾ç‰‡ ====================
        function loadImage(elementId, imageKey) {
            const imgConfig = imageConfig[imageKey] || imageConfig.placeholder;
            const element = document.getElementById(elementId);
            
            if (element && imgConfig.url) {
                element.innerHTML = `<img src="${imgConfig.url}" alt="${imgConfig.alt}" title="${imgConfig.desc}">`;
            }
        }

        // ==================== ä¿®æ”¹çš„openDiaryå‡½æ•° ====================
        function openDiary(diaryId) {
            const diaryContent = {
                diary1: { 
                    title: "éº¦å½“åŠ³", 
                    content: editableContent.diary1Content,
                    imageKey: "diary1"
                },
                diary2: { 
                    title: "å°å–éƒ¨", 
                    content: editableContent.diary2Content 
                },
                diary3: { 
                    title: "å‚¨ç‰©æŸœ", 
                    content: editableContent.diary3Content 
                }
            };

            const diary = diaryContent[diaryId];
            if (diary) {
                document.getElementById('modalTitle').textContent = diary.title;
                document.getElementById('modalBody').innerHTML = `<div class="diary-full-content editable-content" data-key="${diaryId}Content">${diary.content}</div>`;
                openModal('modalOverlay');

                // åŠ è½½å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
                if (diary.imageKey) {
                    // ç­‰å¾…æ¨¡æ€æ¡†æ¸²æŸ“å®Œæˆ
                    setTimeout(() => {
                        loadImage(diary.imageKey + 'Image', diary.imageKey);
                    }, 100);
                }

                // Hide unread dot
                const dotNum = diaryId.replace('diary', '');
                const dot = document.getElementById('dot' + dotNum);
                if (dot) dot.style.display = 'none';

                // Update progress
                if (!gameState.unlockedPages.includes(parseInt(dotNum) + 1)) {
                    gameState.unlockedPages.push(parseInt(dotNum) + 1);
                    gameState.progress = Math.max(gameState.progress, parseInt(dotNum) + 1);
                    updateProgress();
                }

                // Add photo to album
                addPhotoToAlbum(diaryId);
            }
        }

        // ==================== ä¿®æ”¹çš„addPhotoToAlbumå‡½æ•° ====================
        function addPhotoToAlbum(photoId) {
            if (!gameState.albumPhotos.includes(photoId)) {
                gameState.albumPhotos.push(photoId);
                updateAlbum();
            }
        }

        function updateAlbum() {
            const albumGrid = document.getElementById('albumGrid');
            if (!albumGrid) return;

            // æ¸…ç©ºç›¸å†Œï¼ˆé™¤äº†å ä½ç¬¦ï¼‰
            const emptyAlbum = document.getElementById('albumEmpty');
            if (emptyAlbum) emptyAlbum.remove();

            // æ·»åŠ æ‰€æœ‰è§£é”çš„ç…§ç‰‡
            albumGrid.innerHTML = '';
            
            gameState.albumPhotos.forEach(photoId => {
                const imgConfig = imageConfig[photoId] || imageConfig.placeholder;
                const albumItem = document.createElement('div');
                albumItem.className = 'album-item';
                albumItem.onclick = () => viewPhoto(photoId);
                
                if (imgConfig.url) {
                    albumItem.innerHTML = `<img src="${imgConfig.url}" alt="${imgConfig.alt}" class="album-img">`;
                } else {
                    albumItem.innerHTML = `<div class="album-placeholder">${imgConfig.alt || photoId}</div>`;
                }
                
                albumGrid.appendChild(albumItem);
            });

            // å¦‚æœç›¸å†Œä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º
            if (gameState.albumPhotos.length === 0) {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'album-item';
                emptyItem.id = 'albumEmpty';
                emptyItem.innerHTML = '<div class="album-placeholder">æš‚æ— ç…§ç‰‡<br>æ¢ç´¢æ—¥å¿—è§£é”æ›´å¤š</div>';
                albumGrid.appendChild(emptyItem);
            }
        }

        function viewPhoto(photoId) {
            const imgConfig = imageConfig[photoId] || imageConfig.placeholder;
            const content = `
                <div style="text-align: center; padding: 20px;">
                    <h3>${imgConfig.desc || photoId}</h3>
                    ${imgConfig.url ? 
                        `<img src="${imgConfig.url}" alt="${imgConfig.alt}" style="max-width: 100%; max-height: 60vh; border-radius: 12px; margin: 20px 0;">` :
                        `<div class="image-placeholder" style="height: 300px; display: flex; align-items: center; justify-content: center;">${imgConfig.alt}</div>`
                    }
                    <p style="color: var(--text-secondary); margin-top: 20px;">${imgConfig.desc || ''}</p>
                </div>
            `;
            
            showCustomModal(content, [{ text: 'å…³é—­', action: closeCustomModal }]);
        }

        // ==================== ä¿®å¤startGameå‡½æ•° ====================
        function startGame() {
            const introPage = document.getElementById('introPage');
            const mainContainer = document.getElementById('mainContainer');
            
            if (introPage && mainContainer) {
                introPage.style.display = 'none';
                mainContainer.classList.add('active');
                gameState.progress = 1;
                updateProgress();
                showPopup("åº”å¹¿å¤§ç”¨æˆ·è¦æ±‚ï¼Œ'æœç´¢'åŠŸèƒ½ç°å·²ä¸Šçº¿ï¼æ‚¨å¯ä½¿ç”¨å³ä¸Šè§’çš„æœç´¢æ¡†æ£€ç´¢æœªæ˜¾ç¤ºçš„å†…å®¹ã€‚");
                
                // åˆå§‹åŒ–ç›¸å†Œ
                updateAlbum();
            } else {
                console.error('é¡µé¢å…ƒç´ æœªæ‰¾åˆ°');
                alert('é¡µé¢åŠ è½½å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // ==================== ä¿®æ”¹çš„initå‡½æ•° ====================
        function init() {
            // Dark mode detection
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });

            // Enter key for search
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }

            // æµ‹è¯•ï¼šå¦‚æœæŒ‰é’®ç‚¹å‡»æœ‰é—®é¢˜ï¼Œä¹Ÿæ·»åŠ é”®ç›˜æ”¯æŒ
            const startBtn = document.querySelector('.start-btn');
            if (startBtn) {
                startBtn.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        startGame();
                    }
                });
            }

            updateProgress();
            
            // åˆå§‹åŒ–æ—¶åŠ è½½ä¸€äº›é»˜è®¤å›¾ç‰‡
            setTimeout(() => {
                loadImage('mcdonaldsImage', 'diary1');
                loadImage('childrenParkImage', 'childrenPark');
            }, 500);
        }

        // ==================== åŸæœ‰çš„å…¶ä»–å‡½æ•°ä¿æŒä¸å˜ ====================
        // ... ä¿æŒåŸæœ‰çš„å…¶ä»–å‡½æ•°ä¸å˜ ...

        // ==================== åˆå§‹åŒ– ====================
        // ç¡®ä¿DOMåŠ è½½å®Œæˆåå†æ‰§è¡Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>